!function(){"use strict";var a=angular.module("illumination");a.directive("scheduler",[function(){return{restrict:"E",templateUrl:"plugins/plugins/scheduler/template/template.html",controller:"schedulerController",controllerAs:"schedulerCtrl",replace:!0}}]),a.controller("schedulerController",["schedulerService","$timeout","eventEmitter",function(a,b,c){function d(a){$('[name="bootstrap-switch-scheduler"]').bootstrapSwitch("state",a),0==a?c.emit("enableGpios"):c.emit("disableGpios")}function e(a){var b=parseInt(a.split(":")[0]),c=parseInt(a.split(":")[1]);return[b,c]}var f=this;f.state=!1,f.error="",f.dateTimePickers=[new Date,new Date],f.save=function(){var b=f.dateTimePickers[0].getHours()+":"+f.dateTimePickers[0].getMinutes(),c=f.dateTimePickers[1].getHours()+":"+f.dateTimePickers[1].getMinutes();a.setSchedulerSchedule(b,c,function(a,b){return a?void console.log(a):void 0})},c.emit("updateGpios"),b(function(){var b=$("[name='bootstrap-switch-scheduler']").bootstrapSwitch();b.on("switchChange.bootstrapSwitch",function(b,c){a.setSchedulerState(c,function(b,e){a.setSchedulerState(c,function(a,b){return a?(console.log(a),$('[name="bootstrap-switch-scheduler"]').bootstrapSwitch("state",!1)):void d(b.state)})})}),a.getSchedulerState(function(a,b){if(a)return console.log(a),$('[name="bootstrap-switch-scheduler"]').bootstrapSwitch("state",!1);var c=new Date,g=e(b.startTime);f.dateTimePickers[0]=new Date(c.getFullYear(),c.getMonth(),c.getDate(),g[0],g[1],0);var h=e(b.endTime);f.dateTimePickers[1]=new Date(c.getFullYear(),c.getMonth(),c.getDate(),h[0],h[1],0),d(b.state)})},100)}]),a.service("schedulerService",["$http",function(a){var b={getSchedulerState:function(b){var c=a.get("/scheduler");c.then(function(a){b(null,a.data)},function(a){b(a,null)})},setSchedulerState:function(b,c){var d=a.put("/scheduler",{state:b});d.then(function(a){c(null,a.data)},function(a){c(a,null)})},setSchedulerSchedule:function(b,c,d){var e=a.put("/scheduler/interval",{startTime:b,endTime:c});e.then(function(a){d(null,a.data)},function(a){d(a,null)})}};return b}])}();